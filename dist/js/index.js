let curIndex,indexObj,dataAll,len=0,player=window.player;function init(){bindEvent(),getData()}function getData(){$.ajax({type:"GET",url:"./mock/data.json",success:function(a){dataAll=a,curIndex=0,len=a.length,$("body").trigger("data:click"),indexObj=new player.index(len),renderPlayList()}})}function prevLoad(){player.audio.load(dataAll[curIndex].audio),"play"===player.audio.status?(player.audio.play(),player.pro.start()):player.pro.update(0)}function bindEvent(){$("body").on("data:click",(function(a,l){l&&(curIndex=indexObj.getNewIndex(l),renderPlayList()),player.render(dataAll[curIndex]),player.pro.renderAlltime(dataAll[curIndex].duration),prevLoad()})),$(".btn.isPlay").on("click",(function(){"noPlay"===player.audio.status?(player.audio.play(),player.pro.start(),$(this).removeClass("noPlay").addClass("play")):(player.audio.pause(),player.pro.stop(),$(this).removeClass("play").addClass("noPlay"))})),$(".btn.prev").on("click",(function(){$("body").trigger("data:click","prev")})),$(".btn.next").on("click",(function(){$("body").trigger("data:click","next")}));let a,l,t,e=$(".process-wrapper").offset().left,n=$(".process-wrapper").offset().width;$(".slot").on("touchstart",(function(){player.pro.stop(),$(this).on("touchmove",(function(t){a=t.changedTouches[0].clientX-e,l=a/n,(l<0||l>1)&&(l=0),player.pro.update(l)})),$(this).on("touchend",(function(o){a=o.changedTouches[0].clientX-e,l=a/n,(l<0||l>1)&&(l=0),t=Math.round(l*dataAll[curIndex].duration),player.audio.playTo(t),"noPlay"===player.audio.status&&$(".btn.isPlay").removeClass("noPlay").addClass("play"),player.audio.status="play",player.pro.start(l)}))})),$(".btn.list").on("click",(function(){$(".playList").css("display","block")})),$(".playList button").on("click",(function(){$(".playList").css("display","none")})),$(".playList ul").on("click",(function(a){$(".playList button").click(),curIndex=$(a.target).index(),renderPlayList(),"noPlay"===player.audio.status&&$(".btn.isPlay").removeClass("noPlay").addClass("play"),player.audio.status="play",$("body").trigger("data:click")}))}function renderPlayList(){let a="";for(let l=0;l<dataAll.length;l++)a+=l==curIndex?'<li class="active">'+dataAll[l].song+"-"+dataAll[l].singer+"</li>":"<li>"+dataAll[l].song+"-"+dataAll[l].singer+"</li>";$(".playList ul").html(a)}init();